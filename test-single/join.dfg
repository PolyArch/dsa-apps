Input: A
Input: B

C = Compare64(A, B, self={1:b1, 2:b2})
O = Accumulate64(B, control=C{0:d, 1:a, 2:a|b1, 3:r})

Output: O

